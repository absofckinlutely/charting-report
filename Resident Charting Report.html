<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resident Visit Charting Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9;
        }

        .container {
            max-width: 1024px;
            margin: 2rem auto;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            padding: 2rem;
        }

        /* Styling for the table-like grid structure */
        .charting-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            border: 1px solid #94a3b8;
            border-radius: 6px;
            overflow: hidden;
            background-color: #ffffff;
        }

        .grid-header {
            background-color: #e2e8f0;
            font-weight: 700;
            padding: 1rem;
            border-bottom: 1px solid #94a3b8;
            border-right: 1px solid #94a3b8;
            text-align: center;
        }

        .grid-header:last-child {
            border-right: none;
        }

        .grid-section-title {
            grid-column: 1 / 3;
            background-color: #f8fafc;
            font-weight: 600;
            padding: 0.75rem 1rem;
            border-top: 1px solid #94a3b8;
            border-bottom: 1px solid #94a3b8;
        }

        .grid-row-item {
            padding: 1rem;
            border-bottom: 1px solid #e2e8f0;
            /* Light row separator */
        }

        .grid-row-item-left {
            border-right: 1px solid #94a3b8;
            min-height: 100%;
        }

        .notes-textarea {
            width: 100%;
            height: 100%;
            min-height: 8rem;
            /* Base height for notes column */
            resize: vertical;
            padding: 0.5rem;
            border: 1px solid #cbd5e1;
            border-radius: 4px;
            transition: all 0.2s;
        }

        /* Modal Styling */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 2rem;
            width: 90%;
            max-width: 400px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            text-align: center;
        }
    </style>
</head>

<body class="bg-gray-100">

    <!-- Confirmation Modal -->
    <div id="submissionModal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="closeModal"
                class="absolute top-3 right-5 text-gray-500 hover:text-gray-900 cursor-pointer text-3xl font-light">&times;</span>
            <div id="modalIconContainer">
                <svg id="successIcon" xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto mb-4 text-green-500"
                    viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd"
                        d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                        clip-rule="evenodd" />
                </svg>
                <svg id="errorIcon" xmlns="http://www.w3.org/2000/svg"
                    class="h-16 w-16 mx-auto mb-4 text-red-500 hidden" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd"
                        d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
                        clip-rule="evenodd" />
                </svg>
            </div>
            <h3 id="modalTitle" class="text-2xl font-semibold text-gray-800">Submission Successful!</h3>
            <p id="modalMessage" class="mt-2 text-gray-600">Your report has been submitted successfully.</p>
            <button id="modalCloseButton"
                class="mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition duration-150">Close</button>
        </div>
    </div>

    <div class="container p-6 md:p-8">
        <header class="mb-6 border-b pb-4">
            <div class="flex items-center justify-between">
                <h1 class="text-2xl font-bold text-gray-800">Resident Visit Charting Report</h1>
                <div class="flex items-center">
                    <img src="https://placehold.co/80x30/292524/FFFFFF?text=GRAYDON+HALL" alt="Graydon Hall Logo"
                        class="h-6 mr-2"
                        onerror="this.onerror=null;this.src='https://placehold.co/80x30/292524/FFFFFF?text=GH';">
                    <p class="text-xs text-gray-600">APARTMENTS</p>
                </div>
            </div>
        </header>

        <form id="chartingForm" class="space-y-6">

            <!-- General Information Fields (Top Section) -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4 text-sm font-medium border-b border-gray-300 pb-4">
                <div class="space-y-2">
                    <label class="block text-gray-700">Date:
                        <input type="date" name="date" required
                            class="w-full mt-1 p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm">
                    </label>
                    <label class="block text-gray-700">Resident Name:
                        <input type="text" name="residentName" required
                            class="w-full mt-1 p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm">
                    </label>
                    <label class="block text-gray-700">PSW/Employee Name:
                        <input type="text" name="pswName" required
                            class="w-full mt-1 p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm">
                    </label>
                    <label class="block text-gray-700">Primary Care Giver:
                        <input type="text" name="primaryCareGiver"
                            class="w-full mt-1 p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm">
                    </label>
                </div>

                <div class="space-y-2">
                    <label class="block text-gray-700">Building - Suite:
                        <input type="text" name="buildingSuite" required
                            class="w-full mt-1 p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm">
                    </label>
                    <label class="block text-gray-700">Time In:
                        <input type="time" name="timeIn" required
                            class="w-full mt-1 p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm">
                    </label>
                    <label class="block text-gray-700">Time Out:
                        <input type="time" name="timeOut" required
                            class="w-full mt-1 p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm">
                    </label>

                    <fieldset class="pt-2">
                        <legend class="text-gray-700 mb-1">Mobility:</legend>
                        <div class="flex space-x-4">
                            <label class="flex items-center text-sm font-normal">
                                <input type="radio" name="mobility" value="Ambulatory" class="form-radio h-4 w-4 text-blue-600 rounded" required>
                                <span class="ml-1 text-gray-700">Ambulatory</span>
                            </label>
                            <label class="flex items-center text-sm font-normal">
                                <input type="radio" name="mobility" value="Non-Ambulatory" class="form-radio h-4 w-4 text-blue-600 rounded">
                                <span class="ml-1 text-gray-700">Non-Ambulatory</span>
                            </label>
                        </div>
                    </fieldset>
                </div>
            </div>

            <!-- Main Charting Grid -->
            <div class="charting-grid text-sm">
                <!-- Headers -->
                <div class="grid-header grid-row-item-left">Mandatory Question</div>
                <div class="grid-header">Notes:</div>

                <!-- 1. General Appearance -->
                <div class="grid-row-item grid-row-item-left space-y-2">
                    <h4 class="font-semibold mb-2">General Appearance <span class="text-xs font-normal">(Check all that apply)</span></h4>
                    <div class="space-y-1">
                        <label class="flex items-center"><input type="checkbox" name="appearance" value="Clean and well-groomed" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Clean and well-groomed</span></label>
                        <label class="flex items-center"><input type="checkbox" name="appearance" value="Tired or fatigued" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Tired or fatigued</span></label>
                        <label class="flex items-center"><input type="checkbox" name="appearance" value="Dirty or unkempt" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Dirty or unkempt</span></label>
                        <label class="flex items-center"><input type="checkbox" name="appearance" value="Poor hygiene (e.g. body odor, greasy hair)" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Poor hygiene (e.g. body odor, greasy hair)</span></label>
                        <label class="flex items-center"><input type="checkbox" name="appearance" value="Inappropriate clothing for weather" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Inappropriate clothing for weather</span></label>
                        <label class="flex items-center"><input type="checkbox" name="appearance" value="Visible bruises or skin issues" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Visible bruises or skin issues</span></label>
                        <label class="flex items-center"><input type="checkbox" name="appearance" value="Appears unwell or sick" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Appears unwell or sick</span></label>
                    </div>
                </div>
                <div class="grid-row-item">
                    <textarea name="notes_appearance" class="notes-textarea" placeholder="Notes on General Appearance..."></textarea>
                </div>

                <!-- 2. Mood/Behaviour -->
                <div class="grid-row-item grid-row-item-left space-y-2">
                    <h4 class="font-semibold mb-2">Mood/Behaviour <span class="text-xs font-normal">(check all that apply)</span></h4>
                    <div class="flex flex-wrap gap-x-4 gap-y-2">
                        <label class="flex items-center"><input type="checkbox" name="mood" value="Calm" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Calm</span></label>
                        <label class="flex items-center"><input type="checkbox" name="mood" value="Talkative" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Talkative</span></label>
                        <label class="flex items-center"><input type="checkbox" name="mood" value="Anxious" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Anxious</span></label>
                        <label class="flex items-center"><input type="checkbox" name="mood" value="Agitated" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Agitated</span></label>
                        <label class="flex items-center"><input type="checkbox" name="mood" value="Sad" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Sad</span></label>
                        <label class="flex items-center"><input type="checkbox" name="mood" value="Confused" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Confused</span></label>
                    </div>
                </div>
                <div class="grid-row-item">
                    <textarea name="notes_mood" class="notes-textarea" placeholder="Notes on Mood/Behaviour..."></textarea>
                </div>

                <!-- 3. Orientation -->
                <div class="grid-row-item grid-row-item-left space-y-2">
                    <h4 class="font-semibold mb-2">Orientation</h4>
                    <div class="space-y-1">
                        <label class="flex items-center"><input type="checkbox" name="orientation" value="Alert and aware" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Alert and aware</span></label>
                        <label class="flex items-center"><input type="checkbox" name="orientation" value="Slightly confused" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Slightly confused</span></label>
                        <label class="flex items-center"><input type="checkbox" name="orientation" value="Disoriented (time/place/person)" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Disoriented (time/place/person)</span></label>
                        <label class="flex items-center"><input type="checkbox" name="orientation" value="Repeating questions" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Repeating questions</span></label>
                        <label class="flex items-center"><input type="checkbox" name="orientation" value="Forgetful but cooperative" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Forgetful but cooperative</span></label>
                        <label class="flex items-center"><input type="checkbox" name="orientation" value="Appears drowsy or groggy" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Appears drowsy or groggy</span></label>
                        <label class="flex items-center"><input type="checkbox" name="orientation" value="Unresponsive or nonverbal" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Unresponsive or nonverbal</span></label>
                    </div>
                </div>
                <div class="grid-row-item">
                    <textarea name="notes_orientation" class="notes-textarea" placeholder="Notes on Orientation..."></textarea>
                </div>

                <!-- 4. Pain and Discomfort -->
                <div class="grid-row-item grid-row-item-left space-y-3">
                    <h4 class="font-semibold mb-2">Pain or Discomfort</h4>
                    <div class="flex space-x-4">
                        <label class="flex items-center"><input type="radio" name="pain_presence" value="Yes" class="form-radio h-4 w-4 text-blue-600"><span class="ml-2">Yes</span></label>
                        <label class="flex items-center"><input type="radio" name="pain_presence" value="No" class="form-radio h-4 w-4 text-blue-600"><span class="ml-2">No</span></label>
                    </div>
                    <label class="block">If **yes** location:
                        <input type="text" name="pain_location" placeholder="e.g., Lower foot and side of leg"
                            class="w-full mt-1 p-1 border border-gray-300 rounded-lg text-sm">
                    </label>
                    <label class="block">Severity (1-10):
                        <input type="text" name="pain_severity" placeholder="e.g., 5/10 on foot, 9/10 on side of foot"
                            class="w-full mt-1 p-1 border border-gray-300 rounded-lg text-sm">
                    </label>
                </div>
                <div class="grid-row-item">
                    <textarea name="notes_pain" class="notes-textarea" placeholder="Notes on Pain or Discomfort..."></textarea>
                </div>

                <!-- 5. Skin Condition -->
                <div class="grid-row-item grid-row-item-left space-y-2">
                    <h4 class="font-semibold mb-2">Skin Condition</h4>
                    <div class="flex flex-wrap gap-x-4 gap-y-1">
                        <label class="flex items-center"><input type="checkbox" name="skin_condition" value="Skin intact" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Skin intact</span></label>
                        <label class="flex items-center"><input type="checkbox" name="skin_condition" value="Redness/Irritation" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Redness/Irritation</span></label>
                        <label class="flex items-center"><input type="checkbox" name="skin_condition" value="Bruising" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Bruising</span></label>
                        <label class="flex items-center"><input type="checkbox" name="skin_condition" value="Rashes or dryness" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Rashes or dryness</span></label>
                        <label class="flex items-center"><input type="checkbox" name="skin_condition" value="Open wounds" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Open wounds</span></label>
                        <label class="flex items-center"><input type="checkbox" name="skin_condition" value="Bedsores" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Bedsores</span></label>
                    </div>
                    <label class="block mt-2">Area(s) of concern:
                        <input type="text" name="skin_area" placeholder="e.g., Left heel, inner forearm"
                            class="w-full mt-1 p-1 border border-gray-300 rounded-lg text-sm">
                    </label>
                </div>
                <div class="grid-row-item">
                    <textarea name="notes_skin" class="notes-textarea" placeholder="Notes on Skin Condition..."></textarea>
                </div>
                
                <!-- 6. Allergies -->
                <div class="grid-row-item grid-row-item-left space-y-2">
                    <h4 class="font-semibold mb-2">Allergies <span class="text-xs font-normal">(Check all that apply)</span></h4>
                    <div class="flex flex-wrap gap-x-4 gap-y-1">
                        <label class="flex items-center"><input type="checkbox" name="allergies" value="Food" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Food</span></label>
                        <label class="flex items-center"><input type="checkbox" name="allergies" value="Medication" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Medication</span></label>
                        <label class="flex items-center"><input type="checkbox" name="allergies" value="Seasonal Allergies" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Seasonal Allergies</span></label>
                        <label class="flex items-center"><input type="checkbox" name="allergies" value="Environmental Allergies" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Environmental Allergies</span></label>
                        <label class="flex items-center"><input type="checkbox" name="allergies" value="Others" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Others</span></label>
                    </div>
                </div>
                <div class="grid-row-item">
                    <textarea name="notes_allergies" class="notes-textarea" placeholder="Notes on Allergies..."></textarea>
                </div>

                <!-- 7. Pain Discomfort Detail -->
                <div class="grid-row-item grid-row-item-left space-y-2">
                    <h4 class="font-semibold mb-2">Pain Discomfort (Detail)</h4>
                    <div class="flex flex-wrap gap-x-4 gap-y-1">
                        <label class="flex items-center"><input type="checkbox" name="pain_detail" value="Normal" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Normal</span></label>
                        <label class="flex items-center"><input type="checkbox" name="pain_detail" value="Slower" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Slower</span></label>
                        <label class="flex items-center"><input type="checkbox" name="pain_detail" value="Needs Help" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Needs Help</span></label>
                        <label class="flex items-center"><input type="checkbox" name="pain_detail" value="Unstable" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Unstable</span></label>
                        <label class="flex items-center"><input type="checkbox" name="pain_detail" value="Falls Risk" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Falls Risk</span></label>
                    </div>
                </div>
                <div class="grid-row-item">
                    <textarea name="notes_pain_detail" class="notes-textarea" placeholder="Notes on detailed pain/discomfort observations..."></textarea>
                </div>

                <!-- 8. Eating/Drinking -->
                <div class="grid-row-item grid-row-item-left space-y-2">
                    <h4 class="font-semibold mb-2">Eating/Drinking</h4>
                    <div class="flex flex-wrap gap-x-4 gap-y-1">
                        <label class="flex items-center"><input type="checkbox" name="eating_drinking" value="Normal" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Normal</span></label>
                        <label class="flex items-center"><input type="checkbox" name="eating_drinking" value="Reduced Appetite" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Reduced Appetite</span></label>
                        <label class="flex items-center"><input type="checkbox" name="eating_drinking" value="Not Eating" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Not Eating</span></label>
                    </div>
                </div>
                <div class="grid-row-item">
                    <textarea name="notes_eating_drinking" class="notes-textarea" placeholder="Notes on Eating/Drinking..."></textarea>
                </div>
                
                <!-- 9. Medication Taken -->
                <div class="grid-row-item grid-row-item-left space-y-2">
                    <h4 class="font-semibold mb-2">Medication Taken</h4>
                    <div class="flex flex-wrap gap-x-4 gap-y-1">
                        <label class="flex items-center"><input type="checkbox" name="medication_taken" value="Completed" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Completed</span></label>
                        <label class="flex items-center"><input type="checkbox" name="medication_taken" value="Not Taken" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Not Taken</span></label>
                        <label class="flex items-center"><input type="checkbox" name="medication_taken" value="Refused" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Refused</span></label>
                        <label class="flex items-center"><input type="checkbox" name="medication_taken" value="Not Applicable" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Not Applicable</span></label>
                    </div>
                </div>
                <div class="grid-row-item">
                    <textarea name="notes_medication_taken" class="notes-textarea" placeholder="Notes on Medication Taken..."></textarea>
                </div>
                
                <!-- 10. Toileting/Bathroom Needs -->
                <div class="grid-row-item grid-row-item-left space-y-2">
                    <h4 class="font-semibold mb-2">Toileting/Bathroom Needs</h4>
                    <div class="flex flex-wrap gap-x-4 gap-y-1">
                        <label class="flex items-center"><input type="checkbox" name="toileting" value="Independent" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Independent</span></label>
                        <label class="flex items-center"><input type="checkbox" name="toileting" value="Needed assistance" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Needed assistance</span></label>
                        <label class="flex items-center"><input type="checkbox" name="toileting" value="Accident" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Accident</span></label>
                        <label class="flex items-center"><input type="checkbox" name="toileting" value="Not Applicable" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Not Applicable</span></label>
                    </div>
                </div>
                <div class="grid-row-item">
                    <textarea name="notes_toileting" class="notes-textarea" placeholder="Notes on Toileting/Bathroom Needs..."></textarea>
                </div>
                
                <!-- 11. Sleep -->
                <div class="grid-row-item grid-row-item-left space-y-2 border-b-0">
                    <h4 class="font-semibold mb-2">Sleep</h4>
                    <div class="space-y-1">
                        <label class="flex items-center"><input type="checkbox" name="sleep" value="Slept well last night" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Slept well last night</span></label>
                        <label class="flex items-center"><input type="checkbox" name="sleep" value="Slept poorly/restless" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Slept poorly/restless</span></label>
                        <label class="flex items-center"><input type="checkbox" name="sleep" value="Napped during the day" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Napped during the day</span></label>
                        <label class="flex items-center"><input type="checkbox" name="sleep" value="Reports difficulty sleeping" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Reports difficulty sleeping</span></label>
                    </div>
                </div>
                <div class="grid-row-item border-b-0">
                    <textarea name="notes_sleep" class="notes-textarea" placeholder="Notes on Sleep..."></textarea>
                </div>

            </div>
            <!-- End Main Charting Grid -->

            <!-- Follow-up Actions Needed -->
            <div class="mt-8 border border-gray-400 rounded-lg p-6 bg-yellow-50 shadow-md">
                <h3 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">Follow-up Actions Needed <span class="text-sm font-normal">(check all that apply)</span></h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                    <div class="space-y-2">
                        <label class="flex items-center"><input type="checkbox" name="follow_up" value="Refer to nurse" class="form-checkbox h-4 w-4 text-red-600 rounded"><span class="ml-2 font-semibold text-red-700">Refer to nurse</span></label>
                        <label class="flex items-center"><input type="checkbox" name="follow_up" value="Social/emotional follow-up" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Social/emotional follow-up</span></label>
                        <label class="flex items-center"><input type="checkbox" name="follow_up" value="Encourage hydration or nutrition" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Encourage hydration or nutrition</span></label>
                        <label class="flex items-center"><input type="checkbox" name="follow_up" value="Monitor for changes in condition" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Monitor for changes in condition</span></label>
                        <label class="flex items-center"><input type="checkbox" name="follow_up" value="Reassure resident/provide emotional support" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Reassure resident/provide emotional support</span></label>
                        <label class="flex items-center"><input type="checkbox" name="follow_up" value="Provide assistance with ADLs (e.g. hygiene, dressing)" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Provide assistance with ADLs (e.g. hygiene, dressing)</span></label>
                        <label class="flex items-center"><input type="checkbox" name="follow_up" value="Report for medication review" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Report for medication review</span></label>
                    </div>
                    <div class="space-y-2">
                        <label class="flex items-center"><input type="checkbox" name="follow_up" value="Coordinate with building manager" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Coordinate with building manager</span></label>
                        <label class="flex items-center"><input type="checkbox" name="follow_up" value="Alert emergency services (if urgent)" class="form-checkbox h-4 w-4 text-red-600 rounded"><span class="ml-2 font-semibold text-red-700">Alert emergency services (if urgent)</span></label>
                        <label class="flex items-center"><input type="checkbox" name="follow_up" value="Suggest medical appointment/follow-up with doctor" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Suggest medical appointment/follow-up with doctor</span></label>
                        <label class="flex items-center"><input type="checkbox" name="follow_up" value="Communicate concerns to POA or guardian" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Communicate concerns to POA or guardian</span></label>
                        <label class="flex items-center"><input type="checkbox" name="follow_up" value="Check for safety hazards in unit" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Check for safety hazards in unit</span></label>
                        <label class="flex items-center"><input type="checkbox" name="follow_up" value="Monitor for mental health concerns" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Monitor for mental health concerns</span></label>
                        <label class="flex items-center"><input type="checkbox" name="follow_up" value="Arrange for social worker or counselor visit" class="form-checkbox h-4 w-4 text-blue-600 rounded"><span class="ml-2">Arrange for social worker or counselor visit</span></label>
                    </div>
                </div>
            </div>

            <!-- Final Comments/Observations -->
            <div class="mt-8 space-y-6">
                <div>
                    <h3 class="text-lg font-bold text-gray-800 mb-2">Resident Comments or Concerns:</h3>
                    <textarea name="resident_comments" rows="4" class="w-full p-3 border border-gray-400 rounded-lg focus:ring-blue-500 focus:border-blue-500 shadow-sm"></textarea>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-gray-800 mb-2">PSW Observations/Concerns:</h3>
                    <textarea name="psw_observations" rows="6" class="w-full p-3 border border-gray-400 rounded-lg focus:ring-blue-500 focus:border-blue-500 shadow-sm"></textarea>
                </div>
            </div>

            <!-- Submission Button and Feedback -->
            <div class="text-center pt-6">
                <button type="submit" id="submitButton"
                    class="w-full md:w-auto px-12 py-4 bg-blue-600 text-white font-bold text-xl rounded-xl hover:bg-blue-700 transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-300 shadow-lg shadow-blue-500/50"
                    disabled>
                    Submit Report
                </button>
                <p id="loadingMessage" class="mt-4 text-blue-600 font-medium hidden">Submitting report, please wait...</p>
                <p id="formError" class="mt-4 text-red-600 font-medium hidden">Please fill out all required fields.</p>
            </div>
        </form>
    </div>

    <script>
        // **CONFIRMED GOOGLE APPS SCRIPT URL**
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzN9W_16WP8gOAYVvJiJtmUu4GFGD16H11b-QZQoZfx66ouTfwHkSshAwoMe9ZED62fMA/exec'; 
        const form = document.getElementById('chartingForm');
        const submitButton = document.getElementById('submitButton');
        const loadingMessage = document.getElementById('loadingMessage');
        const formError = document.getElementById('formError');
        const modal = document.getElementById('submissionModal');
        const closeModalButton = document.getElementById('closeModal');
        const modalCloseButton = document.getElementById('modalCloseButton');
        const modalTitle = document.getElementById('modalTitle');
        const modalMessage = document.getElementById('modalMessage');
        const successIcon = document.getElementById('successIcon');
        const errorIcon = document.getElementById('errorIcon');

        // --- Utility Functions ---

        /**
         * Converts form data into a simple object suitable for API submission.
         * Handles multiple selected checkboxes as a single comma-separated string.
         * @param {HTMLFormElement} formElement
         * @returns {Object}
         */
        function serializeForm(formElement) {
            const formData = new FormData(formElement);
            const data = {};
            const multiValueFields = {}; // To handle checkbox arrays

            for (const [key, value] of formData.entries()) {
                if (key in data) {
                    // This is a multi-select field (like a checkbox group). Use an array for temporary storage.
                    if (!Array.isArray(multiValueFields[key])) {
                        multiValueFields[key] = [data[key]]; // Start array with first value
                    }
                    multiValueFields[key].push(value);
                } else {
                    data[key] = value;
                }
            }

            // Merge multi-value fields back, converting arrays to comma-separated strings
            for (const key in multiValueFields) {
                data[key] = multiValueFields[key].join(', ');
            }

            return data;
        }

        /**
         * Displays the submission status modal.
         * @param {boolean} success - True for success, false for failure.
         * @param {string} message - The message to display.
         */
        function showModal(success, message) {
            if (success) {
                modalTitle.textContent = 'Submission Successful!';
                modalMessage.textContent = 'Your report has been submitted successfully.';
                successIcon.classList.remove('hidden');
                errorIcon.classList.add('hidden');
                modalCloseButton.classList.remove('bg-red-600', 'hover:bg-red-700');
                modalCloseButton.classList.add('bg-blue-600', 'hover:bg-blue-700');
            } else {
                modalTitle.textContent = 'Submission Failed!';
                modalMessage.textContent = message || 'An unexpected error occurred. Please check your network connection.';
                successIcon.classList.add('hidden');
                errorIcon.classList.remove('hidden');
                modalCloseButton.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                modalCloseButton.classList.add('bg-red-600', 'hover:bg-red-700');
            }
            modal.style.display = 'block';
        }

        /**
         * Hides the submission status modal.
         */
        function hideModal() {
            modal.style.display = 'none';
        }

        /**
         * Toggles the state of the submit button based on form validity.
         */
        function checkValidityAndToggleSubmit() {
            // Check HTML5 validity for all required fields
            const isFormValid = form.checkValidity();
            submitButton.disabled = !isFormValid;

            if (!isFormValid) {
                // If form is invalid but the user attempts to submit, show the error message.
                // Otherwise, keep it hidden.
                if (form.classList.contains('submitted')) {
                     formError.classList.remove('hidden');
                }
            } else {
                formError.classList.add('hidden');
            }
        }

        // --- Event Handlers ---

        /**
         * Handles the form submission process.
         * @param {Event} event
         */
        async function handleSubmit(event) {
            event.preventDefault();
            form.classList.add('submitted'); // Mark form as submitted to enable error visibility

            if (!form.checkValidity()) {
                formError.classList.remove('hidden');
                return;
            }

            const payload = serializeForm(form);

            // Show loading state
            submitButton.disabled = true;
            loadingMessage.classList.remove('hidden');
            formError.classList.add('hidden');

            try {
                // Using fetch with 'no-cors' is necessary for Google Apps Script
                await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors', 
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams(payload).toString()
                });

                showModal(true);
                form.reset(); // Clear form on assumed success

            } catch (error) {
                console.error('Submission error:', error);
                showModal(false, `Network or system error: ${error.message}.`);
            } finally {
                loadingMessage.classList.add('hidden');
                submitButton.disabled = false;
                form.classList.remove('submitted'); // Reset submitted state
                checkValidityAndToggleSubmit(); // Re-check state after reset
            }
        }

        // --- Initialization and Event Listeners ---

        // Attach main submit listener
        form.addEventListener('submit', handleSubmit);

        // Attach modal closing listeners
        closeModalButton.addEventListener('click', hideModal);
        modalCloseButton.addEventListener('click', hideModal);
        window.addEventListener('click', (event) => {
            if (event.target === modal) {
                hideModal();
            }
        });

        // Initial setup and input listener for dynamic validation
        window.addEventListener('load', () => {
            checkValidityAndToggleSubmit(); // Initial check for submit button state

            // Listen to all inputs for dynamic validation
            form.addEventListener('input', checkValidityAndToggleSubmit);
        });

    </script>
</body>

</html>
